<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Digital Twin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tandem Viewer CSS -->
  <link href="https://static.tandem.autodesk.com/1.0.605/style.css" rel="stylesheet" type="text/css">
  <style>
    :root {
      --sidebar-bg: #222428;
      --sidebar-active: #2d3748;
      --sidebar-text: #bfc3ce;
      --sidebar-title: #fff;
      --main-bg: #141517;
      --card-bg: #23262b;
      --card-border: #292c31;
      --card-title: #bfc3ce;
      --card-value: #49a6ff;
      --card-desc: #8fa0b2;
      --header-bg: #191b1f;
      --header-title: #61b0ff;
      --btn-bg: #2d3748;
      --btn-text: #fff;
      --btn-active: #49a6ff;
      --btn-success: #28a745;
      --btn-warning: #ffc107;
      --btn-danger: #dc3545;
      --divider: #363941;
      --scrollbar: #333;
      --accent: #6c5ecb;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--main-bg);
      color: #fff;
      font-family: 'Segoe UI', 'Malgun Gothic', Arial, sans-serif;
    }
    
    body {
      height: 100vh;
      display: flex;
      flex-direction: column;
      min-width: 1200px;
      overflow: hidden;
    }
    
    /* ìƒë‹¨ í—¤ë” */
    .header {
      width: 100%;
      height: 56px;
      background: var(--header-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      box-sizing: border-box;
      border-bottom: 1px solid var(--divider);
      z-index: 10;
    }
    
    .header-title {
      font-size: 1.4em;
      font-weight: 700;
      color: var(--header-title);
      letter-spacing: 1px;
      display: flex;
      align-items: center;
    }
    
    .header-title span {
      color: #49a6ff;
      margin-right: 8px;
      font-size: 1.2em;
      font-weight: 900;
    }
    
    .header-menu {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .header-btn {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .header-btn:hover {
      background: var(--btn-active);
    }
    
    .header-btn.active {
      background: var(--btn-success);
      color: #fff;
    }
    
    .header-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #dc3545;
      display: inline-block;
      margin-right: 6px;
      animation: pulse 2s infinite;
    }
    
    .status-indicator.connected {
      background: #28a745;
      animation: none;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    /* ì „ì²´ ë ˆì´ì•„ì›ƒ */
    .dashboard-layout {
      display: flex;
      flex: 1 1 auto;
      height: calc(100vh - 56px);
      min-height: 0;
    }
    
    /* ì¢Œì¸¡ ì‚¬ì´ë“œë°” */
    .sidebar {
      width: 320px;
      background: var(--sidebar-bg);
      display: flex;
      flex-direction: column;
      padding: 24px 0;
      box-sizing: border-box;
      border-right: 1px solid var(--divider);
      overflow-y: auto;
    }
    
    .sidebar-section {
      margin-bottom: 24px;
    }
    
    .sidebar-section-title {
      font-size: 1.05em;
      color: var(--sidebar-title);
      margin: 0 0 12px 24px;
      font-weight: 700;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-right: 24px;
    }
    
    .sidebar-dropdown {
      margin: 0 16px 16px 16px;
    }
    
    .sidebar-dropdown select {
      width: 100%;
      background: var(--card-bg);
      color: var(--sidebar-text);
      border: 1px solid var(--card-border);
      border-radius: 6px;
      padding: 10px 12px;
      font-size: 0.95em;
      cursor: pointer;
      outline: none;
    }
    
    .sidebar-dropdown select:focus {
      border-color: var(--btn-active);
    }
    
    .sidebar-dropdown label {
      display: block;
      font-size: 0.9em;
      color: var(--sidebar-text);
      margin-bottom: 6px;
      font-weight: 500;
    }
    
    .load-btn {
      background: var(--btn-active);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      margin: 16px;
      transition: all 0.2s;
    }
    
    .load-btn:hover {
      background: #3d8bfd;
    }
    
    .load-btn:disabled {
      background: var(--btn-bg);
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    /* ì¤‘ì•™ ì»¨í…ì¸  */
    .main-content {
      flex: 1 1 auto;
      min-width: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(ellipse at center, #23262b 0%, #141517 100%);
      position: relative;
    }
    
    /* í˜ì´ì§€ ì»¨í…Œì´ë„ˆ */
    .page-container {
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    .page-content {
      width: 100%;
      height: 100%;
      display: none;
    }
    
    .page-content.active {
      display: block;
    }
    
    /* Tandem Viewer ì»¨í…Œì´ë„ˆ */
    #tandem-viewer-container {
      width: 100%;
      height: 100%;
      display: none;
    }
    
    /* ì´ˆê¸° í™”ë©´ */
    .center-content {
      text-align: center;
      color: #bfc3ce;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 320px;
    }
    
    .viewer-icon {
      width: 92px;
      height: 92px;
      margin-bottom: 18px;
      border-radius: 24px;
      background: linear-gradient(135deg, #5ecbff 0%, #6c5ecb 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.4em;
      color: #fff;
      box-shadow: 0 2px 12px rgba(80,120,255,0.12);
    }
    
    .viewer-title {
      font-size: 1.3em;
      font-weight: 700;
      margin-bottom: 10px;
      color: #fff;
    }
    
    .viewer-desc {
      color: #bfc3ce;
      font-size: 1.08em;
      margin-bottom: 0;
      line-height: 1.4;
    }
    
    /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(20, 21, 23, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .loading-content {
      text-align: center;
      color: #bfc3ce;
    }
    
    .loading-spinner {
      border: 3px solid #333;
      border-top: 3px solid #49a6ff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 1.1em;
      margin-bottom: 8px;
    }
    
    .loading-progress {
      font-size: 0.9em;
      color: #8fa0b2;
    }
    
    /* ìš°ì¸¡ ì‹¤ì‹œê°„ ë°ì´í„° ì¹´ë“œ */
    .right-panel {
      width: 320px;
      background: none;
      padding: 32px 16px 32px 0;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      z-index: 2;
    }
    
    .realtime-card {
      width: 100%;
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 4px 18px rgba(30,60,120,0.12);
      padding: 20px 18px 20px 24px;
      box-sizing: border-box;
      border: 1px solid var(--card-border);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    
    .realtime-title {
      font-size: 1.14em;
      color: #fff;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .realtime-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    
    .realtime-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .realtime-label {
      color: #bfc3ce;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 7px;
      font-weight: 500;
    }
    
    .realtime-value {
      color: var(--card-value);
      font-size: 1.25em;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .realtime-value.door-open {
      color: #ff6b6b;
      animation: doorAlert 1s infinite;
    }
    
    .realtime-value.door-closed {
      color: #28a745;
    }
    
    @keyframes doorAlert {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .realtime-desc {
      color: var(--card-desc);
      font-size: 0.96em;
      margin-left: 28px;
      margin-top: 2px;
    }
    
    .realtime-icon {
      font-size: 1.15em;
      margin-right: 5px;
    }
    
    /* ë¬¸ ëª¨ë‹ˆí„°ë§ ì¹´ë“œ */
    .door-monitoring-card {
      width: 100%;
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 4px 18px rgba(30,60,120,0.12);
      padding: 20px 18px 20px 24px;
      box-sizing: border-box;
      border: 1px solid var(--card-border);
      margin-bottom: 20px;
    }
    
    .door-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .door-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      transition: all 0.3s;
    }
    
    .door-item.open {
      background: rgba(255, 107, 107, 0.2);
      border: 1px solid rgba(255, 107, 107, 0.4);
    }
    
    .door-item.closed {
      background: rgba(40, 167, 69, 0.2);
      border: 1px solid rgba(40, 167, 69, 0.4);
    }
    
    .door-name {
      font-weight: 600;
      color: #fff;
    }
    
    .door-status {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .door-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #28a745;
    }
    
    .door-indicator.open {
      background: #ff6b6b;
      animation: pulse 2s infinite;
    }
    
    .door-actions {
      display: flex;
      gap: 4px;
    }
    
    .door-action-btn {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .door-action-btn:hover {
      background: var(--btn-active);
    }
    
    /* í†µê³„ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    .statistics-page {
      padding: 20px;
      overflow-y: auto;
      height: 100%;
    }
    
    .stats-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--divider);
    }
    
    .stats-title {
      font-size: 2em;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .stats-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .date-selector {
      background: var(--card-bg);
      color: var(--sidebar-text);
      border: 1px solid var(--card-border);
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 0.9em;
      cursor: pointer;
      outline: none;
    }
    
    .refresh-btn {
      background: var(--btn-active);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .refresh-btn:hover {
      background: #3d8bfd;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--card-border);
      box-shadow: 0 4px 18px rgba(30,60,120,0.12);
    }
    
    .stat-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .stat-card-title {
      font-size: 1.1em;
      font-weight: 600;
      color: #fff;
    }
    
    .stat-card-icon {
      font-size: 1.5em;
      color: var(--card-value);
    }
    
    .stat-value {
      font-size: 2.5em;
      font-weight: 700;
      color: var(--card-value);
      margin-bottom: 8px;
    }
    
    .stat-description {
      color: var(--card-desc);
      font-size: 0.9em;
      margin-bottom: 16px;
    }
    
    .stat-trend {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9em;
    }
    
    .trend-up {
      color: #28a745;
    }
    
    .trend-down {
      color: #dc3545;
    }
    
    .trend-neutral {
      color: #ffc107;
    }
    
    .chart-container {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--card-border);
      margin-bottom: 20px;
      box-shadow: 0 4px 18px rgba(30,60,120,0.12);
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .chart-title {
      font-size: 1.3em;
      font-weight: 600;
      color: #fff;
    }
    
    .chart-controls {
      display: flex;
      gap: 8px;
    }
    
    .chart-btn {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .chart-btn:hover {
      background: var(--btn-active);
    }
    
    .chart-btn.active {
      background: var(--btn-active);
    }
    
    .chart-canvas {
      width: 100%;
      height: 300px !important;
      max-height: 300px !important;
      background: rgba(255,255,255,0.02);
      border-radius: 8px;
      margin-top: 10px;
    }
    
    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .table-container {
      margin-top: 10px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--card-border);
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--main-bg);
    }
    
    .data-table thead th {
      background: var(--sidebar-bg);
      color: #fff;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 1px solid var(--card-border);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .data-table tbody td {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      color: var(--sidebar-text);
    }
    
    .data-table tbody tr:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .data-table tbody tr:nth-child(even) {
      background: rgba(255,255,255,0.02);
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 600;
      text-align: center;
      min-width: 50px;
      display: inline-block;
    }
    
    .status-badge.open {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
      border: 1px solid rgba(255, 107, 107, 0.4);
    }
    
    .status-badge.closed {
      background: rgba(40, 167, 69, 0.2);
      color: #28a745;
      border: 1px solid rgba(40, 167, 69, 0.4);
    }
    
    /* ì—ëŸ¬/ì„±ê³µ ë©”ì‹œì§€ */
    .message {
      padding: 12px 20px;
      border-radius: 8px;
      margin: 16px;
      text-align: center;
      display: none;
      font-weight: 500;
    }
    
    .error-message {
      background: #dc3545;
      color: white;
      border: 1px solid #c82333;
    }
    
    .success-message {
      background: #28a745;
      color: white;
      border: 1px solid #1e7e34;
    }
    
    .info-message {
      background: #17a2b8;
      color: white;
      border: 1px solid #138496;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” */
    ::-webkit-scrollbar { 
      width: 7px; 
      background: var(--sidebar-bg);
    }
    ::-webkit-scrollbar-thumb { 
      background: var(--scrollbar); 
      border-radius: 7px;
    }
    ::selection { 
      background: #49a6ff33; 
    }
    
    /* ë°˜ì‘í˜• */
    @media (max-width: 1400px) {
      .sidebar { width: 280px; }
      .right-panel { width: 280px; }
    }
    
    @media (max-width: 1200px) {
      .sidebar { width: 200px; }
      .right-panel { width: 220px; }
    }
    
    @media (max-width: 900px) {
      .sidebar { display: none; }
      .right-panel { display: none; }
      .main-content { flex: 1 1 auto; }
    }
  </style>
</head>
<body>
  <!-- ìƒë‹¨ í—¤ë” -->
  <div class="header">
    <div class="header-title">
      <span>ğŸ—ï¸</span> Digital Twin Dashboard
    </div>
    <div class="header-menu">
      <button class="header-btn" onclick="showPage('viewer')" id="home-btn">
        ğŸ  í™ˆ
      </button>
      <button class="header-btn" onclick="showPage('statistics')" id="stats-btn">
        ğŸ“Š í†µê³„
      </button>
      <button class="header-btn" id="connect-btn" onclick="initializeTandem()">
        <span class="status-indicator" id="status-indicator"></span>
        <span id="connect-text">Tandem ì—°ê²°</span>
      </button>
      <button class="header-btn" id="sheets-status" style="opacity: 0.7;">
        <span class="status-indicator" id="sheets-indicator"></span>
        <span id="sheets-text">Sheets ë¯¸ì—°ê²°</span>
      </button>
    </div>
  </div>
  
  <!-- ë©”ì‹œì§€ ì˜ì—­ -->
  <div class="error-message message" id="error-message"></div>
  <div class="success-message message" id="success-message"></div>
  <div class="info-message message" id="info-message"></div>
  
  <div class="dashboard-layout">
    <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
      <!-- íŒ€ ì„ íƒ -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">íŒ€ ì„ íƒ</div>
        <div class="sidebar-dropdown">
          <label for="team-select">íŒ€:</label>
          <select id="team-select" onchange="onTeamChange()" disabled>
            <option value="">ì—°ê²° í›„ ì„ íƒ ê°€ëŠ¥</option>
          </select>
        </div>
      </div>
      
      <!-- ì‹œì„¤ ì„ íƒ -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">ì‹œì„¤ ì„ íƒ</div>
        <div class="sidebar-dropdown">
          <label for="facility-select">ì‹œì„¤:</label>
          <select id="facility-select" onchange="onFacilityChange()" disabled>
            <option value="">íŒ€ ì„ íƒ í›„ í‘œì‹œ</option>
          </select>
        </div>
      </div>
      
      <!-- ë·° ì„ íƒ -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">ë·° ì„ íƒ</div>
        <div class="sidebar-dropdown">
          <label for="view-select">ë·°:</label>
          <select id="view-select" onchange="onViewChange()" disabled>
            <option value="">ì‹œì„¤ ì„ íƒ í›„ í‘œì‹œ</option>
          </select>
        </div>
        <button class="load-btn" id="load-btn" onclick="loadSelectedView()" disabled>
          ì„ íƒëœ ë·° ë¡œë“œ
        </button>
      </div>
      
      <!-- ì§ì ‘ URN ë¡œë“œ -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">ì§ì ‘ URN ë¡œë“œ</div>
        <div class="sidebar-dropdown">
          <label for="urn-input">Facility URN:</label>
          <input type="text" id="urn-input" placeholder="urn:adsk.dtt:..." 
                 style="width: 100%; background: var(--card-bg); color: var(--sidebar-text); 
                        border: 1px solid var(--card-border); border-radius: 6px; 
                        padding: 8px 12px; font-size: 0.9em; margin-bottom: 8px;">
          <label for="view-id-input">View ID (ì„ íƒì‚¬í•­):</label>
          <input type="text" id="view-id-input" placeholder="view-id" 
                 style="width: 100%; background: var(--card-bg); color: var(--sidebar-text); 
                        border: 1px solid var(--card-border); border-radius: 6px; 
                        padding: 8px 12px; font-size: 0.9em; margin-bottom: 12px;">
          <button class="load-btn" onclick="loadDirectURN()" style="margin: 0; width: 100%;">
            URNìœ¼ë¡œ ë¡œë“œ
          </button>
        </div>
      </div>
    </div>
    
    <!-- ì¤‘ì•™ ì»¨í…ì¸  -->
    <div class="main-content">
      <div class="page-container">
        <!-- 3D ë·°ì–´ í˜ì´ì§€ -->
        <div id="viewer-page" class="page-content active">
          <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
          <div class="loading-overlay" id="loading-overlay">
            <div class="loading-content">
              <div class="loading-spinner"></div>
              <div class="loading-text" id="loading-text">Tandem Viewer ì´ˆê¸°í™” ì¤‘...</div>
              <div class="loading-progress" id="loading-progress"></div>
            </div>
          </div>
          
          <!-- ì´ˆê¸° í™”ë©´ -->
          <div class="center-content" id="initial-content">
            <div class="viewer-icon">
              <span style="font-size:2.6em;">ğŸ¢</span>
            </div>
            <div class="viewer-title">Autodesk Tandem Viewer</div>
            <div class="viewer-desc">
              ìƒë‹¨ì˜ 'Tandem ì—°ê²°' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”<br>
              <small>íŒ€ â†’ ì‹œì„¤ â†’ ë·° ìˆœì„œë¡œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ URNìœ¼ë¡œ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</small><br>
              <small style="color: #8fa0b2;">ë‹¨ì¶•í‚¤: Ctrl+T (ì—°ê²°), Ctrl+F (ì „ì²´ í™œì„±í™”), Ctrl+R (í•„í„° ìƒˆë¡œê³ ì¹¨)</small>
            </div>
          </div>
          
          <!-- Tandem Viewer ì»¨í…Œì´ë„ˆ -->
          <div id="tandem-viewer-container"></div>
        </div>

        <!-- í†µê³„ í˜ì´ì§€ -->
        <div id="statistics-page" class="page-content statistics-page">
          <div class="stats-header">
            <div class="stats-title">
              ğŸ“Š ì‹œì„¤ í†µê³„ ëŒ€ì‹œë³´ë“œ
            </div>
            <div class="stats-controls">
              <select class="date-selector" id="date-range-select">
                <option value="today">ì˜¤ëŠ˜</option>
                <option value="week" selected>ì´ë²ˆ ì£¼</option>
                <option value="month">ì´ë²ˆ ë‹¬</option>
                <option value="year">ì˜¬í•´</option>
              </select>
              <button class="refresh-btn" onclick="refreshStatistics()">
                ğŸ”„ ìƒˆë¡œê³ ì¹¨
              </button>
            </div>
          </div>

          <!-- ì£¼ìš” ì§€í‘œ ì¹´ë“œë“¤ -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-card-header">
                <span class="stat-card-title">í‰ê·  ì˜¨ë„</span>
                <span class="stat-card-icon">ğŸŒ¡ï¸</span>
              </div>
              <div class="stat-value" id="avg-temp">--</div>
              <div class="stat-description">ì§€ë‚œ ì£¼ ëŒ€ë¹„</div>
              <div class="stat-trend">
                <span class="trend-neutral">--</span>
                <span>ë°ì´í„° ì—†ìŒ</span>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-card-header">
                <span class="stat-card-title">í‰ê·  ìŠµë„</span>
                <span class="stat-card-icon">ğŸ’§</span>
              </div>
              <div class="stat-value" id="avg-humidity">--</div>
              <div class="stat-description">ì§€ë‚œ ì£¼ ëŒ€ë¹„</div>
              <div class="stat-trend">
                <span class="trend-neutral">--</span>
                <span>ë°ì´í„° ì—†ìŒ</span>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-card-header">
                <span class="stat-card-title">ì´ ì—ë„ˆì§€ ì†Œë¹„</span>
                <span class="stat-card-icon">âš¡</span>
              </div>
              <div class="stat-value" id="total-energy">--</div>
              <div class="stat-description">ì§€ë‚œ ì£¼ ëŒ€ë¹„</div>
              <div class="stat-trend">
                <span class="trend-neutral">--</span>
                <span>ë°ì´í„° ì—†ìŒ</span>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-card-header">
                <span class="stat-card-title">ë¬¸ ê°œí íšŸìˆ˜</span>
                <span class="stat-card-icon">ğŸšª</span>
              </div>
              <div class="stat-value" id="door-events">--</div>
              <div class="stat-description">ì§€ë‚œ ì£¼ ëŒ€ë¹„</div>
              <div class="stat-trend">
                <span class="trend-neutral">--</span>
                <span>ë°ì´í„° ì—†ìŒ</span>
              </div>
            </div>
          </div>

          <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
          <div class="chart-container">
            <div class="chart-header">
              <span class="chart-title">ì˜¨ë„ ë³€í™” ì¶”ì´</span>
              <div class="chart-controls">
                <button class="chart-btn active" onclick="setChartPeriod('temperature', 'day')">ì¼ê°„</button>
                <button class="chart-btn" onclick="setChartPeriod('temperature', 'week')">ì£¼ê°„</button>
                <button class="chart-btn" onclick="setChartPeriod('temperature', 'month')">ì›”ê°„</button>
              </div>
            </div>
            <canvas id="temperature-chart" class="chart-canvas"></canvas>
          </div>

          <div class="chart-container">
            <div class="chart-header">
              <span class="chart-title">ì—ë„ˆì§€ ì†Œë¹„ëŸ‰</span>
              <div class="chart-controls">
                <button class="chart-btn active" onclick="setChartPeriod('energy', 'day')">ì¼ê°„</button>
                <button class="chart-btn" onclick="setChartPeriod('energy', 'week')">ì£¼ê°„</button>
                <button class="chart-btn" onclick="setChartPeriod('energy', 'month')">ì›”ê°„</button>
              </div>
            </div>
            <canvas id="energy-chart" class="chart-canvas"></canvas>
          </div>

          <div class="chart-container">
            <div class="chart-header">
              <span class="chart-title">ìŠµë„ ë³€í™” ì¶”ì´</span>
              <div class="chart-controls">
                <button class="chart-btn active" onclick="setChartPeriod('humidity', 'day')">ì¼ê°„</button>
                <button class="chart-btn" onclick="setChartPeriod('humidity', 'week')">ì£¼ê°„</button>
                <button class="chart-btn" onclick="setChartPeriod('humidity', 'month')">ì›”ê°„</button>
              </div>
            </div>
            <canvas id="humidity-chart" class="chart-canvas"></canvas>
          </div>

          <!-- ë¬¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§ í…Œì´ë¸” -->
          <div class="chart-container">
            <div class="chart-header">
              <span class="chart-title">ë¬¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§</span>
              <div class="chart-controls">
                <button class="chart-btn" onclick="refreshDoorData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>ë¬¸ ì´ë¦„</th>
                    <th>í˜„ì¬ ìƒíƒœ</th>
                    <th>ë§ˆì§€ë§‰ ë³€ê²½</th>
                    <th>ì˜¤ëŠ˜ ê°œí íšŸìˆ˜</th>
                    <th>ìƒíƒœ</th>
                  </tr>
                </thead>
                <tbody id="door-status-table">
                  <!-- ë¬¸ ìƒíƒœ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- ì „ì²´ ë°ì´í„° í…Œì´ë¸” -->
          <div class="chart-container">
            <div class="chart-header">
              <span class="chart-title">ì „ì²´ ë°ì´í„° (ìµœê·¼ 20ê°œ)</span>
              <div class="chart-controls">
                <button class="chart-btn" onclick="refreshDataTable()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                <button class="chart-btn" onclick="exportDataTable()">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
              </div>
            </div>
            <div class="table-container" style="max-height: 400px; overflow-y: auto;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>ì‹œê°„</th>
                    <th>ì˜¨ë„ (Â°C)</th>
                    <th>ìŠµë„ (%)</th>
                    <th>ì—ë„ˆì§€ (kWh)</th>
                    <th>ë¬¸ ì´ë²¤íŠ¸</th>
                    <th>ì¡°ë„ (lux)</th>
                  </tr>
                </thead>
                <tbody id="all-data-table">
                  <!-- ì „ì²´ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ìš°ì¸¡ íŒ¨ë„ë“¤ -->
    <div class="right-panel">
      <!-- ë¬¸ ëª¨ë‹ˆí„°ë§ ì¹´ë“œ -->
      <div class="door-monitoring-card">
        <div class="realtime-title">ë¬¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§</div>
        <div class="door-list" id="door-list">
          <!-- ë¬¸ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </div>
      
      <!-- ì‹¤ì‹œê°„ ë°ì´í„° -->
      <div class="realtime-card">
        <div class="realtime-title">ì‹¤ì‹œê°„ ë°ì´í„°</div>
        <ul class="realtime-list">
          <li class="realtime-item">
            <span class="realtime-label">
              <span class="realtime-icon">ğŸŒ¡ï¸</span>ì˜¨ë„
            </span>
            <span class="realtime-value" id="temp-value">--</span>
          </li>
          <li class="realtime-desc" id="temp-desc"></li>
          
          <li class="realtime-item">
            <span class="realtime-label">
              <span class="realtime-icon">ğŸ’§</span>ìŠµë„
            </span>
            <span class="realtime-value" id="hum-value">--</span>
          </li>
          <li class="realtime-desc" id="hum-desc"></li>
          
          <li class="realtime-item">
            <span class="realtime-label">
              <span class="realtime-icon">âš¡</span>ì—ë„ˆì§€
            </span>
            <span class="realtime-value" id="energy-value">--</span>
          </li>
          <li class="realtime-desc" id="energy-desc"></li>
          
          <li class="realtime-item">
            <span class="realtime-label">
              <span class="realtime-icon">ğŸ’¡</span>ì¡°ë„
            </span>
            <span class="realtime-value" id="illumin-value">--</span>
          </li>
          <li class="realtime-desc" id="illumin-desc"></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Tandem Viewer JavaScript -->
  <script src="https://static.tandem.autodesk.com/1.0.605/viewer3D.js"></script>
  <!-- Chart.js for statistics -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
  <script>
    // ====== Google Sheets API ì„¤ì • (í•˜ë“œì½”ë”©) ======
    const GOOGLE_SHEETS_CONFIG = {
      apiKey: "YOUR_GOOGLE_SHEETS_API_KEY_HERE",
      spreadsheetId: "YOUR_SPREADSHEET_ID_HERE", 
      sheetName: "ë°ì´í„°",
      columnMapping: {
        timestamp: "A",
        temperature: "B", 
        humidity: "C",
        energy: "D",
        door_events: "E",
        illumination: "F"
      }
    };
    
    // ====== Tandem API ì„¤ì • ======
    // TODO: ì„œë²„ í™˜ê²½ì—ì„œëŠ” ì´ ê°’ë“¤ì„ ì œê±°í•˜ê³  /api/auth/token APIë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
    // í´ë¼ì´ì–¸íŠ¸ ì „ìš© ê°œë°œ ì‹œì—ë§Œ ì‚¬ìš© (í”„ë¡œë•ì…˜ì—ì„œëŠ” ë³´ì•ˆìƒ ê¶Œì¥í•˜ì§€ ì•ŠìŒ)
    const APS_CLIENT_ID = "YOUR_CLIENT_ID_HERE";
    const APS_CLIENT_SECRET = "YOUR_CLIENT_SECRET_HERE";
    
    // ì„œë²„ API ì‚¬ìš© ì—¬ë¶€ (true: ì„œë²„ API ì‚¬ìš©, false: í´ë¼ì´ì–¸íŠ¸ ì§ì ‘ ì¸ì¦)
    const USE_SERVER_API = false;
    
    // ===============================
    
    // ì „ì—­ ë³€ìˆ˜
    let tandemApp = null;
    let viewer = null;
    let isConnected = false;
    let currentPage = 'viewer';
    let doors = [];
    let charts = {};
    let previousDoorStates = {};
    let doorMarkers = [];
    let isGoogleSheetsConnected = false;
    let dataLogInterval = null;
    let syncInterval = null;
    
    // ë¬¸ ì •ë³´ (ë™ì•„ë¦¬ ë°© ë¬¸ í•˜ë‚˜ë§Œ ëª¨ë‹ˆí„°ë§)
    const doorConfig = [
      { id: 'club_door', name: 'ë™ì•„ë¦¬ ë°© ë¬¸', position: [0, 0, 0], status: 'closed', dbId: 100 }
    ];
    
    // Google Sheets API ì´ˆê¸°í™” (í•˜ë“œì½”ë”©ëœ ì„¤ì • ì‚¬ìš©)
    function initGoogleSheets() {
      try {
        if (!GOOGLE_SHEETS_CONFIG.apiKey || !GOOGLE_SHEETS_CONFIG.spreadsheetId) {
          console.warn('Google Sheets API ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
          updateGoogleSheetsStatus(false);
          return;
        }
        
        // ê°„ë‹¨í•œ ì—°ê²° í…ŒìŠ¤íŠ¸
        testGoogleSheetsConnection();
        
      } catch (error) {
        console.error('Google Sheets ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        updateGoogleSheetsStatus(false);
      }
    }
    
    // Google Sheets ì—°ê²° í…ŒìŠ¤íŠ¸
    async function testGoogleSheetsConnection() {
      try {
        const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
        const response = await fetch(testUrl);
        
        if (response.ok) {
          isGoogleSheetsConnected = true;
          updateGoogleSheetsStatus(true);
          console.log('Google Sheets ì—°ê²° ì„±ê³µ');
        } else {
          const errorData = await response.json();
          console.error('Google Sheets ì—°ê²° ì‹¤íŒ¨:', errorData);
          updateGoogleSheetsStatus(false);
        }
      } catch (error) {
        console.error('Google Sheets ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
        updateGoogleSheetsStatus(false);
      }
    }
    
    // Google Sheets ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateGoogleSheetsStatus(connected) {
      const btn = document.getElementById('sheets-status');
      const indicator = document.getElementById('sheets-indicator');
      const text = document.getElementById('sheets-text');
      
      if (connected) {
        btn.style.opacity = '1';
        btn.classList.add('active');
        indicator.classList.add('connected');
        text.textContent = 'Sheets ì—°ê²°ë¨';
        isGoogleSheetsConnected = true;
      } else {
        btn.style.opacity = '0.7';
        btn.classList.remove('active');
        indicator.classList.remove('connected');
        text.textContent = 'Sheets ë¯¸ì—°ê²°';
        isGoogleSheetsConnected = false;
      }
    }
    
    // ë°ì´í„° ë¡œê¹… ì‹œì‘
    function startDataLogging() {
      if (dataLogInterval) {
        clearInterval(dataLogInterval);
      }
      
      // 5ë¶„ë§ˆë‹¤ ë°ì´í„° ë¡œê¹…
      dataLogInterval = setInterval(logDataToGoogleSheets, 5 * 60 * 1000);
      
      // ì¦‰ì‹œ í•œ ë²ˆ ì‹¤í–‰
      logDataToGoogleSheets();
      
      console.log('Google Sheets ë°ì´í„° ë¡œê¹… ì‹œì‘ (5ë¶„ ê°„ê²©)');
    }
    
    // ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ì‹œì‘ (30ì´ˆ ê°„ê²©)
    function startRealtimeSync() {
      if (syncInterval) {
        clearInterval(syncInterval);
      }
      
      // 30ì´ˆë§ˆë‹¤ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”
      syncInterval = setInterval(syncRealtimeData, 30 * 1000);
      
      // ì¦‰ì‹œ í•œ ë²ˆ ì‹¤í–‰
      syncRealtimeData();
      
      console.log('ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ì‹œì‘ (30ì´ˆ ê°„ê²©)');
    }
    
    // ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” (ì‹¤ì œ ì„¼ì„œ ë°ì´í„°ë§Œ ì‚¬ìš©)
    async function syncRealtimeData() {
      if (!isGoogleSheetsConnected) return;
      
      try {
        const now = new Date();
        
        // ì‹¤ì œ ì„¼ì„œ ê°’ ì½ê¸° (ë”ë¯¸ë°ì´í„° ì œê±°)
        const tempText = document.getElementById('temp-value').textContent;
        const humText = document.getElementById('hum-value').textContent;
        const energyText = document.getElementById('energy-value').textContent;
        const illuminText = document.getElementById('illumin-value').textContent;
        
        // ê°’ì´ '--'ì¸ ê²½ìš° ë™ê¸°í™”í•˜ì§€ ì•ŠìŒ
        if (tempText === '--' || humText === '--' || energyText === '--' || illuminText === '--') {
          console.log('ì„¼ì„œ ë°ì´í„°ê°€ ì—†ì–´ ë™ê¸°í™”ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.');
          return;
        }
        
        const data = {
          timestamp: now.toISOString(),
          temperature: parseFloat(tempText.replace('Â°C', '')) || 0,
          humidity: parseFloat(humText.replace('%', '')) || 0,
          energy: parseFloat(energyText.replace('kWh', '')) || 0,
          door_events: doors.filter(d => d.status === 'open').length,
          illumination: parseFloat(illuminText.replace('lux', '')) || 0
        };
        
        // Google Sheetsì— ë°ì´í„° ì¶”ê°€
        const values = [[
          data.timestamp,
          data.temperature.toFixed(1),
          data.humidity.toFixed(0),
          data.energy.toFixed(1),
          data.door_events,
          data.illumination.toFixed(0)
        ]];
        
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}:append?valueInputOption=RAW&key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
        
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            values: values
          })
        });
        
        if (response.ok) {
          console.log('ì‹¤ì‹œê°„ ë°ì´í„°ê°€ Google Sheetsì— ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤:', data);
        } else {
          const errorData = await response.json();
          console.error('Google Sheets ë™ê¸°í™” ì‹¤íŒ¨:', errorData);
        }
        
      } catch (error) {
        console.error('ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:', error);
      }
    }
    
    // Google Sheetsì— ë°ì´í„° ë¡œê¹… (ê¸°ì¡´ í•¨ìˆ˜, ì´ì œ syncRealtimeDataì™€ í†µí•©ë¨)
    async function logDataToGoogleSheets() {
      // syncRealtimeDataì™€ ë™ì¼í•œ ê¸°ëŠ¥ì´ë¯€ë¡œ í˜¸ì¶œë§Œ í•¨
      await syncRealtimeData();
    }
    
    function showPage(pageName) {
      const pages = document.querySelectorAll('.page-content');
      pages.forEach(page => page.classList.remove('active'));
      
      const targetPage = document.getElementById(`${pageName}-page`);
      if (targetPage) {
        targetPage.classList.add('active');
        currentPage = pageName;
        
        // í†µê³„ í˜ì´ì§€ë¡œ ì „í™˜ ì‹œ ì°¨íŠ¸ ì´ˆê¸°í™”
        if (pageName === 'statistics') {
          setTimeout(() => {
            initializeCharts();
            refreshStatistics();
          }, 100);
        }
      }
      
      // í—¤ë” ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
      const headerBtns = document.querySelectorAll('.header-btn');
      headerBtns.forEach(btn => btn.classList.remove('active'));
      
      if (pageName === 'statistics') {
        headerBtns[0].classList.add('active');
      }
    }
    
    // ë¬¸ ìƒíƒœ ì´ˆê¸°í™”
    function initializeDoors() {
      doors = doorConfig.map(door => ({ ...door }));
      
      // ì´ì „ ìƒíƒœ ì €ì¥
      doors.forEach(door => {
        previousDoorStates[door.id] = door.status;
      });
      
      updateDoorDisplay();
    }
    
    // ë¬¸ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateDoorDisplay() {
      const doorList = document.getElementById('door-list');
      doorList.innerHTML = '';
      
      doors.forEach(door => {
        const doorItem = document.createElement('div');
        doorItem.className = `door-item ${door.status}`;
        doorItem.innerHTML = `
          <div class="door-name">${door.name}</div>
          <div class="door-status">
            <span class="door-indicator ${door.status}"></span>
            <span>${door.status === 'open' ? 'ì—´ë¦¼' : 'ë‹«í˜'}</span>
            <div class="door-actions">
              <button class="door-action-btn" onclick="focusOnDoor('${door.id}')">ë³´ê¸°</button>
            </div>
          </div>
        `;
        doorList.appendChild(doorItem);
      });
    }
    
    // ë¬¸ ìƒíƒœ ë³€í™” ê°ì§€ ë° ì²˜ë¦¬
    function checkDoorStateChanges() {
      doors.forEach(door => {
        const previousState = previousDoorStates[door.id];
        
        if (previousState !== door.status) {
          // ìƒíƒœ ë³€í™” ê°ì§€
          if (door.status === 'open') {
            handleDoorOpened(door);
          } else {
            handleDoorClosed(door);
          }
          
          // ìƒíƒœ ì—…ë°ì´íŠ¸
          previousDoorStates[door.id] = door.status;
          
          // Google Sheetsì— ì´ë²¤íŠ¸ ë¡œê¹…
          if (isGoogleSheetsConnected) {
            logDoorEventToGoogleSheets(door);
          }
        }
      });
    }
    
    // ë¬¸ì´ ì—´ë ¸ì„ ë•Œ ì²˜ë¦¬
    function handleDoorOpened(door) {
      // ê²½ê³  í‘œì‹œ
      showError(`ğŸš¨ ${door.name}ì´ ì—´ë ¸ìŠµë‹ˆë‹¤!`);
      
      // 3D ë·°ì–´ì—ì„œ í•´ë‹¹ ë¬¸ìœ¼ë¡œ ì¹´ë©”ë¼ ì´ë™
      if (viewer && viewer.model && currentPage === 'viewer') {
        focusOnDoor(door.id);
      }
      
      // ë¬¸ ìƒ‰ìƒ ë³€ê²½ ë° ë§ˆì»¤ í‘œì‹œ
      highlightDoorInViewer(door, true);
      
      // ì‚¬ìš´ë“œ ì•Œë¦¼
      playNotificationSound();
      
      // ë¸Œë¼ìš°ì € ì•Œë¦¼
      if (Notification.permission === 'granted') {
        new Notification('ë¬¸ ì—´ë¦¼ ê°ì§€', {
          body: `${door.name}ì´ ì—´ë ¸ìŠµë‹ˆë‹¤.`,
          icon: 'ğŸšª'
        });
      }
    }
    
    // ë¬¸ì´ ë‹«í˜”ì„ ë•Œ ì²˜ë¦¬
    function handleDoorClosed(door) {
      showSuccess(`${door.name}ì´ ë‹«í˜”ìŠµë‹ˆë‹¤.`);
      highlightDoorInViewer(door, false);
    }
    
    // Google Sheetsì— ë¬¸ ì´ë²¤íŠ¸ ë¡œê¹…
    async function logDoorEventToGoogleSheets(door) {
      if (!isGoogleSheetsConnected) return;
      
      try {
        const event = {
          timestamp: new Date().toISOString(),
          door_id: door.id,
          door_name: door.name,
          action: door.status,
          position: door.position.join(',')
        };
        
        // ë³„ë„ì˜ ì´ë²¤íŠ¸ ì‹œíŠ¸ì— ê¸°ë¡ (ìˆëŠ” ê²½ìš°)
        const eventSheetName = 'ë¬¸ì´ë²¤íŠ¸';
        const values = [[
          event.timestamp,
          event.door_id,
          event.door_name,
          event.action,
          event.position
        ]];
        
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${eventSheetName}:append?valueInputOption=RAW&key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
        
        await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            values: values
          })
        });
        
        console.log('ë¬¸ ì´ë²¤íŠ¸ê°€ Google Sheetsì— ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤:', event);
        
      } catch (error) {
        console.error('ë¬¸ ì´ë²¤íŠ¸ ë¡œê¹… ì‹¤íŒ¨:', error);
      }
    }
    
    // 3D ë·°ì–´ì—ì„œ ë¬¸ì— í¬ì»¤ìŠ¤
    function focusOnDoor(doorId) {
      const door = doors.find(d => d.id === doorId);
      if (!door || !viewer) return;
      
      try {
        if (door.dbId && viewer.model) {
          // ì‹¤ì œ 3D ìš”ì†Œê°€ ìˆëŠ” ê²½ìš°
          viewer.select([door.dbId]);
          viewer.fitToView([door.dbId]);
          
          // ì¹´ë©”ë¼ ì• ë‹ˆë©”ì´ì…˜
          setTimeout(() => {
            const position = door.position;
            const target = new THREE.Vector3(position[0], position[1], position[2]);
            const camera = new THREE.Vector3(position[0] + 5, position[1] + 5, position[2] + 5);
            
            viewer.navigation.setView(camera, target);
          }, 500);
          
        } else {
          // dbIdê°€ ì—†ëŠ” ê²½ìš° ì¢Œí‘œë¡œ ì´ë™
          const position = door.position;
          const target = new THREE.Vector3(position[0], position[1], position[2]);
          const camera = new THREE.Vector3(position[0] + 5, position[1] + 5, position[2] + 5);
          
          viewer.navigation.setView(camera, target);
        }
        
        showInfo(`${door.name}ìœ¼ë¡œ ì¹´ë©”ë¼ê°€ ì´ë™í–ˆìŠµë‹ˆë‹¤.`);
        
      } catch (error) {
        console.error('ì¹´ë©”ë¼ ì´ë™ ì‹¤íŒ¨:', error);
        showError('ì¹´ë©”ë¼ ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // 3D ë·°ì–´ì—ì„œ ë¬¸ í•˜ì´ë¼ì´íŠ¸
    function highlightDoorInViewer(door, isOpen) {
      if (!viewer || !viewer.model) return;
      
      try {
        if (door.dbId) {
          // ì‹¤ì œ 3D ìš”ì†Œì˜ ìƒ‰ìƒ ë³€ê²½
          const color = isOpen ? new THREE.Color(1, 0, 0) : null; // ë¹¨ê°„ìƒ‰ ë˜ëŠ” ê¸°ë³¸ìƒ‰
          
          if (isOpen) {
            // ë¬¸ì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸
            viewer.setThemingColor(door.dbId, color);
          } else {
            // í•˜ì´ë¼ì´íŠ¸ ì œê±°
            viewer.clearThemingColors(door.dbId);
          }
        }
        
        // ë§ˆì»¤ ì¶”ê°€/ì œê±°
        if (isOpen) {
          addDoorMarker(door);
        } else {
          removeDoorMarker(door.id);
        }
        
      } catch (error) {
        console.error('ë¬¸ í•˜ì´ë¼ì´íŠ¸ ì‹¤íŒ¨:', error);
      }
    }
    
    // ë¬¸ ë§ˆì»¤ ì¶”ê°€
    function addDoorMarker(door) {
      try {
        // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
        removeDoorMarker(door.id);
        
        // ìƒˆ ë§ˆì»¤ ìƒì„±
        const markerGeometry = new THREE.SphereGeometry(0.5, 8, 8);
        const markerMaterial = new THREE.MeshBasicMaterial({ 
          color: 0xff0000,
          transparent: true,
          opacity: 0.8
        });
        
        const marker = new THREE.Mesh(markerGeometry, markerMaterial);
        marker.position.set(door.position[0], door.position[1], door.position[2] + 3);
        
        // ë§ˆì»¤ ì• ë‹ˆë©”ì´ì…˜
        const animate = () => {
          marker.position.z += Math.sin(Date.now() * 0.005) * 0.1;
          requestAnimationFrame(animate);
        };
        animate();
        
        // ë·°ì–´ì— ë§ˆì»¤ ì¶”ê°€
        if (viewer.impl && viewer.impl.scene) {
          viewer.impl.scene.add(marker);
          doorMarkers.push({ id: door.id, marker: marker });
          viewer.impl.invalidate(true);
        }
        
      } catch (error) {
        console.error('ë§ˆì»¤ ì¶”ê°€ ì‹¤íŒ¨:', error);
      }
    }
    
    // ë¬¸ ë§ˆì»¤ ì œê±°
    function removeDoorMarker(doorId) {
      try {
        const markerIndex = doorMarkers.findIndex(m => m.id === doorId);
        if (markerIndex !== -1) {
          const markerObj = doorMarkers[markerIndex];
          
          if (viewer.impl && viewer.impl.scene) {
            viewer.impl.scene.remove(markerObj.marker);
            viewer.impl.invalidate(true);
          }
          
          doorMarkers.splice(markerIndex, 1);
        }
      } catch (error) {
        console.error('ë§ˆì»¤ ì œê±° ì‹¤íŒ¨:', error);
      }
    }
    
    // ì•Œë¦¼ ì‚¬ìš´ë“œ ì¬ìƒ
    function playNotificationSound() {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.5);
        
      } catch (error) {
        console.error('ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', error);
      }
    }
    
    // ë¬¸ ìƒíƒœ í† ê¸€
    function toggleDoor(doorId) {
      const door = doors.find(d => d.id === doorId);
      if (door) {
        door.status = door.status === 'open' ? 'closed' : 'open';
        
        // ìƒíƒœ ë³€í™” ì²´í¬ ë° ì²˜ë¦¬
        checkDoorStateChanges();
        
        // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        updateDoorDisplay();
        
        // í†µê³„ í˜ì´ì§€ì˜ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        if (currentPage === 'statistics') {
          updateDoorStatusTable();
        }
      }
    }
    
    // ì°¨íŠ¸ ì´ˆê¸°í™”
    function initializeCharts() {
      if (charts.temperature) {
        charts.temperature.destroy();
      }
      if (charts.humidity) {
        charts.humidity.destroy();
      }
      if (charts.energy) {
        charts.energy.destroy();
      }
      
      // ì˜¨ë„ ì°¨íŠ¸
      const tempCtx = document.getElementById('temperature-chart').getContext('2d');
      charts.temperature = new Chart(tempCtx, {
        type: 'line',
        data: {
          labels: generateTimeLabels('day'),
          datasets: [{
            label: 'ì˜¨ë„ (Â°C)',
            data: generateTemperatureData(),
            borderColor: '#49a6ff',
            backgroundColor: 'rgba(73, 166, 255, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          layout: {
            padding: 0
          },
          plugins: {
            legend: {
              labels: {
                color: '#bfc3ce'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: '#8fa0b2'
              },
              grid: {
                color: '#292c31'
              }
            },
            y: {
              ticks: {
                color: '#8fa0b2'
              },
              grid: {
                color: '#292c31'
              }
            }
          }
        }
      });
      
      // ìŠµë„ ì°¨íŠ¸
      const humidityCtx = document.getElementById('humidity-chart').getContext('2d');
      charts.humidity = new Chart(humidityCtx, {
        type: 'line',
        data: {
          labels: generateTimeLabels('day'),
          datasets: [{
            label: 'ìŠµë„ (%)',
            data: generateHumidityData(),
            borderColor: '#28a745',
            backgroundColor: 'rgba(40, 167, 69, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          layout: {
            padding: 0
          },
          plugins: {
            legend: {
              labels: {
                color: '#bfc3ce'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: '#8fa0b2'
              },
              grid: {
                color: '#292c31'
              }
            },
            y: {
              ticks: {
                color: '#8fa0b2'
              },
              grid: {
                color: '#292c31'
              }
            }
          }
        }
      });
      
      // ì—ë„ˆì§€ ì°¨íŠ¸
      const energyCtx = document.getElementById('energy-chart').getContext('2d');
      charts.energy = new Chart(energyCtx, {
        type: 'bar',
        data: {
          labels: generateTimeLabels('day'),
          datasets: [{
            label: 'ì—ë„ˆì§€ ì†Œë¹„ (kWh)',
            data: generateEnergyData(),
            backgroundColor: '#6c5ecb',
            borderColor: '#6c5ecb',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          layout: {
            padding: 0
          },
          plugins: {
            legend: {
              labels: {
                color: '#bfc3ce'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: '#8fa0b2'
              },
              grid: {
                color: '#292c31'
              }
            },
            y: {
              ticks: {
                color: '#8fa0b2'
              },
              grid: {
                color: '#292c31'
              }
            }
          }
        }
      });
      
      // í…Œì´ë¸” ë°ì´í„° ì´ˆê¸°í™”
      updateDoorStatusTable();
      updateAllDataTable();
    }
    
    // ì‹œê°„ ë¼ë²¨ ìƒì„±
    function generateTimeLabels(period) {
      const labels = [];
      const now = new Date();
      
      if (period === 'day') {
        for (let i = 23; i >= 0; i--) {
          const time = new Date(now.getTime() - (i * 60 * 60 * 1000));
          labels.push(time.getHours() + ':00');
        }
      } else if (period === 'week') {
        for (let i = 6; i >= 0; i--) {
          const date = new Date(now.getTime() - (i * 24 * 60 * 60 * 1000));
          labels.push(date.toLocaleDateString('ko-KR', { weekday: 'short' }));
        }
      } else if (period === 'month') {
        for (let i = 29; i >= 0; i--) {
          const date = new Date(now.getTime() - (i * 24 * 60 * 60 * 1000));
          labels.push(date.getDate() + 'ì¼');
        }
      }
      
      return labels;
    }
    
    // ì˜¨ë„ ë°ì´í„° ìƒì„± (ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš©)
    function generateTemperatureData() {
      // ë”ë¯¸ë°ì´í„° ì œê±° - ë¹ˆ ë°°ì—´ ë°˜í™˜
      return [];
    }
    
    // ìŠµë„ ë°ì´í„° ìƒì„± (ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš©)
    function generateHumidityData() {
      // ë”ë¯¸ë°ì´í„° ì œê±° - ë¹ˆ ë°°ì—´ ë°˜í™˜
      return [];
    }
    
    // ì—ë„ˆì§€ ë°ì´í„° ìƒì„± (ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš©)
    function generateEnergyData() {
      // ë”ë¯¸ë°ì´í„° ì œê±° - ë¹ˆ ë°°ì—´ ë°˜í™˜
      return [];
    }
    
    // ë¬¸ ìƒíƒœ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš©)
    function updateDoorStatusTable() {
      const tableBody = document.getElementById('door-status-table');
      tableBody.innerHTML = '';
      
      doors.forEach(door => {
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td>${door.name}</td>
          <td><span class="status-badge ${door.status}">${door.status === 'open' ? 'ì—´ë¦¼' : 'ë‹«í˜'}</span></td>
          <td>ë°ì´í„° ì—†ìŒ</td>
          <td>-</td>
          <td>
            <button class="door-action-btn" onclick="focusOnDoor('${door.id}')">ë³´ê¸°</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }
    
    // ì „ì²´ ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš©)
    function updateAllDataTable() {
      const tableBody = document.getElementById('all-data-table');
      tableBody.innerHTML = '';
      
      // ë”ë¯¸ë°ì´í„° ì œê±° - ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ
      const row = document.createElement('tr');
      row.innerHTML = `
        <td colspan="6" style="text-align: center; color: #8fa0b2; padding: 20px;">
          Google Sheetsì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ 'ìƒˆë¡œê³ ì¹¨' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
        </td>
      `;
      tableBody.appendChild(row);
    }
    
    // ë¬¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš©)
    function refreshDoorData() {
      updateDoorStatusTable();
      showInfo('ë¬¸ ìƒíƒœ ë°ì´í„°ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.');
    }
    
    // ì „ì²´ ë°ì´í„° í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ (Google Sheetsì—ì„œë§Œ ë°ì´í„° ë¡œë“œ)
    function refreshDataTable() {
      if (isGoogleSheetsConnected) {
        loadDataFromGoogleSheets();
      } else {
        updateAllDataTable();
        showInfo('Google Sheetsì— ì—°ê²° í›„ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // Google Sheetsì—ì„œ ë°ì´í„° ë¡œë“œí•˜ì—¬ í…Œì´ë¸” ì—…ë°ì´íŠ¸
    async function loadDataFromGoogleSheets() {
      try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error('Google Sheets ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        const data = await response.json();
        const rows = data.values || [];
        
        if (rows.length < 2) {
          throw new Error('ì¶©ë¶„í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        // í—¤ë” ì œì™¸í•˜ê³  ìµœê·¼ 20ê°œ ë°ì´í„°
        const dataRows = rows.slice(-21).slice(1); // ë§ˆì§€ë§‰ 21ê°œì—ì„œ í—¤ë” ì œì™¸
        
        const tableBody = document.getElementById('all-data-table');
        tableBody.innerHTML = '';
        
        dataRows.reverse().forEach(row => {
          const tableRow = document.createElement('tr');
          const timestamp = new Date(row[0]).toLocaleString('ko-KR');
          
          tableRow.innerHTML = `
            <td>${timestamp}</td>
            <td>${parseFloat(row[1] || 0).toFixed(1)}Â°C</td>
            <td>${Math.round(parseFloat(row[2] || 0))}%</td>
            <td>${parseFloat(row[3] || 0).toFixed(1)} kWh</td>
            <td>${parseInt(row[4] || 0)}</td>
            <td>${Math.round(parseFloat(row[5] || 0))} lux</td>
          `;
          tableBody.appendChild(tableRow);
        });
        
        showSuccess('Google Sheetsì—ì„œ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.');
        
      } catch (error) {
        console.error('Google Sheets ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        showError('Google Sheets ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
        
        // ì‹¤íŒ¨ ì‹œ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ì‚¬ìš©
        updateAllDataTable();
      }
    }
    
    // ë°ì´í„° í…Œì´ë¸” CSV ë‚´ë³´ë‚´ê¸°
    function exportDataTable() {
      const table = document.getElementById('all-data-table');
      const rows = table.querySelectorAll('tr');
      const csv = [];
      
      // í—¤ë” ì¶”ê°€
      csv.push('ì‹œê°„,ì˜¨ë„(Â°C),ìŠµë„(%),ì—ë„ˆì§€(kWh),ë¬¸ì´ë²¤íŠ¸,ì¡°ë„(lux)');
      
      // ë°ì´í„° í–‰ ì¶”ê°€
      rows.forEach(row => {
        const cols = row.querySelectorAll('td');
        const rowData = Array.from(cols).map(col => col.textContent.trim());
        csv.push(rowData.join(','));
      });
      
      // CSV íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      const csvContent = csv.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `digital_twin_data_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showSuccess('CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // ì°¨íŠ¸ ê¸°ê°„ ì„¤ì •
    function setChartPeriod(chartType, period) {
      const buttons = document.querySelectorAll(`.chart-controls .chart-btn`);
      buttons.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
      if (charts[chartType]) {
        charts[chartType].data.labels = generateTimeLabels(period);
        if (chartType === 'temperature') {
          charts[chartType].data.datasets[0].data = generateTemperatureData();
        } else if (chartType === 'energy') {
          charts[chartType].data.datasets[0].data = generateEnergyData();
        }
        charts[chartType].update();
      }
    }
    
    // í†µê³„ ìƒˆë¡œê³ ì¹¨ (ì‹¤ì œ ë°ì´í„°ë§Œ ì‚¬ìš©)
    function refreshStatistics() {
      showInfo('í†µê³„ ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤...');
      
      if (isGoogleSheetsConnected) {
        // Google Sheetsì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        loadStatisticsFromGoogleSheets();
        loadDataFromGoogleSheets(); // í…Œì´ë¸” ë°ì´í„°ë„ í•¨ê»˜ ë¡œë“œ
      } else {
        // ë”ë¯¸ë°ì´í„° ì œê±° - ë¹ˆ ìƒíƒœë¡œ í‘œì‹œ
        setTimeout(() => {
          updateStatisticsFromSimulation();
          updateChartsWithSimulationData();
          showInfo('Google Sheetsì— ì—°ê²°í•˜ì—¬ ì‹¤ì œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        }, 1000);
      }
    }
    
    // Google Sheetsì—ì„œ í†µê³„ ë°ì´í„° ë¡œë“œ
    async function loadStatisticsFromGoogleSheets() {
      try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error('Google Sheets ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        const data = await response.json();
        const rows = data.values || [];
        
        if (rows.length < 2) {
          throw new Error('ì¶©ë¶„í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        // í—¤ë” ì œì™¸í•˜ê³  ë°ì´í„° ì²˜ë¦¬
        const dataRows = rows.slice(1);
        
        // ìµœê·¼ ë°ì´í„°ë¡œ í†µê³„ ê³„ì‚°
        const recentData = dataRows.slice(-100); // ìµœê·¼ 100ê°œ ë°ì´í„°
        
        const avgTemp = calculateAverage(recentData, 1); // ì˜¨ë„ ì—´
        const avgHumidity = calculateAverage(recentData, 2); // ìŠµë„ ì—´
        const totalEnergy = calculateSum(recentData, 3); // ì—ë„ˆì§€ ì—´
        const doorEvents = calculateSum(recentData, 4); // ë¬¸ ì´ë²¤íŠ¸ ì—´
        
        // UI ì—…ë°ì´íŠ¸
        document.getElementById('avg-temp').textContent = avgTemp.toFixed(1) + 'Â°C';
        document.getElementById('avg-humidity').textContent = Math.round(avgHumidity) + '%';
        document.getElementById('total-energy').textContent = totalEnergy.toLocaleString() + ' kWh';
        document.getElementById('door-events').textContent = doorEvents;
        
        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        updateChartsWithRealData(recentData);
        
        // ì „ì²´ ë°ì´í„° í…Œì´ë¸”ë„ ì—…ë°ì´íŠ¸ (ë¹„ë™ê¸°ë¡œ)
        setTimeout(() => {
          loadDataFromGoogleSheets();
        }, 500);
        
        showSuccess('Google Sheets ë°ì´í„°ë¡œ í†µê³„ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        
      } catch (error) {
        console.error('Google Sheets ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        showError('Google Sheets ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
        
        // ì‹¤íŒ¨ ì‹œ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ì‚¬ìš©
        updateStatisticsFromSimulation();
        updateChartsWithSimulationData();
      }
    }
    
    // í‰ê·  ê³„ì‚° í—¬í¼ í•¨ìˆ˜
    function calculateAverage(data, columnIndex) {
      const values = data.map(row => parseFloat(row[columnIndex]) || 0).filter(v => v > 0);
      return values.length > 0 ? values.reduce((a, b) => a + b, 0) / values.length : 0;
    }
    
    // í•©ê³„ ê³„ì‚° í—¬í¼ í•¨ìˆ˜
    function calculateSum(data, columnIndex) {
      return data.reduce((sum, row) => sum + (parseFloat(row[columnIndex]) || 0), 0);
    }
    
    // ì‹¤ì œ ë°ì´í„°ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateChartsWithRealData(data) {
      if (charts.temperature) {
        const tempData = data.slice(-24).map(row => parseFloat(row[1]) || 0);
        charts.temperature.data.datasets[0].data = tempData;
        charts.temperature.update();
      }
      
      if (charts.humidity) {
        const humidityData = data.slice(-24).map(row => parseFloat(row[2]) || 0);
        charts.humidity.data.datasets[0].data = humidityData;
        charts.humidity.update();
      }
      
      if (charts.energy) {
        const energyData = data.slice(-24).map(row => parseFloat(row[3]) || 0);
        charts.energy.data.datasets[0].data = energyData;
        charts.energy.update();
      }
      
      // í…Œì´ë¸”ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
      updateDoorStatusTable();
    }
    
    // ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ë”ë¯¸ë°ì´í„° ì œê±°)
    function updateChartsWithSimulationData() {
      // ë”ë¯¸ë°ì´í„° ì œê±° - Google Sheets ì—°ê²°ì„ ì•ˆë‚´
      showInfo('Google Sheetsì— ì—°ê²°í•˜ì—¬ ì‹¤ì œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
      
      // ë¹ˆ ì°¨íŠ¸ë¡œ ì´ˆê¸°í™”
      if (charts.temperature) {
        charts.temperature.data.datasets[0].data = [];
        charts.temperature.update();
      }
      if (charts.humidity) {
        charts.humidity.data.datasets[0].data = [];
        charts.humidity.update();
      }
      if (charts.energy) {
        charts.energy.data.datasets[0].data = [];
        charts.energy.update();
      }
      
      // í…Œì´ë¸”ë„ ë¹ˆ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
      updateDoorStatusTable();
      updateAllDataTable();
    }
    
    // í†µê³„ ì—…ë°ì´íŠ¸ (ë”ë¯¸ë°ì´í„° ì œê±°)
    function updateStatisticsFromSimulation() {
      // ë”ë¯¸ë°ì´í„° ì œê±° - ë¹ˆ ê°’ìœ¼ë¡œ í‘œì‹œ
      document.getElementById('avg-temp').textContent = '--';
      document.getElementById('avg-humidity').textContent = '--';
      document.getElementById('total-energy').textContent = '--';
      document.getElementById('door-events').textContent = '--';
      
      // í…Œì´ë¸”ë„ ë¹ˆ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
      updateDoorStatusTable();
      updateAllDataTable();
    }
    
    // Tandem ì´ˆê¸°í™” í•¨ìˆ˜
    async function initializeTandem() {
      const connectBtn = document.getElementById('connect-btn');
      const connectText = document.getElementById('connect-text');
      const statusIndicator = document.getElementById('status-indicator');
      
      if (isConnected) {
        showInfo('ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
        return;
      }
      
      try {
        connectText.textContent = 'ì—°ê²° ì¤‘...';
        
        // ì‹œë®¬ë ˆì´ì…˜: ì‹¤ì œë¡œëŠ” Tandem API ì—°ê²°
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        isConnected = true;
        connectText.textContent = 'ì—°ê²°ë¨';
        connectBtn.classList.add('active');
        statusIndicator.classList.add('connected');
        
        // Tandem ì—°ê²° ì„±ê³µ ì‹œ Google Sheetsë„ ìë™ìœ¼ë¡œ ì—°ê²° ì‹œë„
        if (!isGoogleSheetsConnected) {
          showInfo('Google Sheets ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤...');
          await testGoogleSheetsConnection();
          
          if (isGoogleSheetsConnected) {
            // ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ì‹œì‘
            startRealtimeSync();
            showSuccess('Tandem ë° Google Sheetsì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
          } else {
            showSuccess('Tandemì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤. Google Sheets ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
          }
        } else {
          showSuccess('Tandemì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
      } catch (error) {
        connectText.textContent = 'Tandem ì—°ê²°';
        showError('Tandem ì—°ê²° ì‹¤íŒ¨: ' + error.message);
      }
    }
    
    // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ (ë”ë¯¸ë°ì´í„° ì œê±°)
    async function fetchStatus() {
      try {
        // ë”ë¯¸ë°ì´í„° ì œê±° - ë¹ˆ ê°’ìœ¼ë¡œ í‘œì‹œ
        document.getElementById('temp-value').textContent = '--';
        document.getElementById('hum-value').textContent = '--';
        document.getElementById('energy-value').textContent = '--';
        document.getElementById('illumin-value').textContent = '--';
        
        // ë”ë¯¸ ë¬¸ ìƒíƒœ ë³€ê²½ ì œê±° - ì‹¤ì œ ì„¼ì„œ ë°ì´í„°ë§Œ ì‚¬ìš©
        
      } catch (e) {
        console.log('ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', e);
      }
    }
    
    // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ë“¤
    function showMessage(type, message, duration = 5000) {
      const messageDiv = document.getElementById(`${type}-message`);
      messageDiv.textContent = message;
      messageDiv.style.display = 'block';
      
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, duration);
    }
    
    function showError(message) {
      showMessage('error', message);
    }
    
    function showSuccess(message) {
      showMessage('success', message);
    }
    
    function showInfo(message) {
      showMessage('info', message);
    }
    
    // ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ì²´í¬
    function checkBrowserCompatibility() {
      return !!(window.fetch && window.Promise && window.localStorage);
    }
    
    // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
    function requestNotificationPermission() {
      if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            showSuccess('ë¸Œë¼ìš°ì € ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
          }
        });
      }
    }
    
    // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì²˜ë¦¬
    function handleVisibilityChange() {
      if (document.hidden) {
        // í˜ì´ì§€ê°€ ìˆ¨ê²¨ì¡Œì„ ë•Œ
        console.log('í˜ì´ì§€ê°€ ë°±ê·¸ë¼ìš´ë“œë¡œ ì „í™˜ë¨');
      } else {
        // í˜ì´ì§€ê°€ ë‹¤ì‹œ ë³´ì¼ ë•Œ
        console.log('í˜ì´ì§€ê°€ í¬ê·¸ë¼ìš´ë“œë¡œ ì „í™˜ë¨');
        fetchStatus(); // ì‹¤ì‹œê°„ ë°ì´í„° ì¦‰ì‹œ ì—…ë°ì´íŠ¸
      }
    }
    
    // ë”ë¯¸ í•¨ìˆ˜ë“¤ (Tandem API ê´€ë ¨)
    function onTeamChange() {
      // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Tandem API í˜¸ì¶œ
      console.log('íŒ€ ë³€ê²½ë¨');
    }
    
    function onFacilityChange() {
      // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Tandem API í˜¸ì¶œ
      console.log('ì‹œì„¤ ë³€ê²½ë¨');
    }
    
    function onViewChange() {
      // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Tandem API í˜¸ì¶œ
      console.log('ë·° ë³€ê²½ë¨');
    }
    
    function loadSelectedView() {
      // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Tandem API í˜¸ì¶œ
      console.log('ì„ íƒëœ ë·° ë¡œë“œ');
      showInfo('ë·° ë¡œë“œ ê¸°ëŠ¥ì€ ì‹¤ì œ Tandem API ì—°ê²° ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤.');
    }
    
    function loadDirectURN() {
      // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” URNìœ¼ë¡œ ì§ì ‘ ë¡œë“œ
      console.log('URN ì§ì ‘ ë¡œë“œ');
      showInfo('URN ë¡œë“œ ê¸°ëŠ¥ì€ ì‹¤ì œ Tandem API ì—°ê²° ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤.');
    }
    
    // ì´ˆê¸°í™”
    window.addEventListener('load', () => {
      console.log('ğŸš€ Digital Twin Dashboard ì´ˆê¸°í™” ì‹œì‘...');
      
      // ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ì²´í¬
      if (!checkBrowserCompatibility()) {
        showError('ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì‹  ë¸Œë¼ìš°ì € ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.');
      }
      
      // ê¸°ë³¸ ì´ˆê¸°í™”
      initializeDoors();
      
      // Google Sheets API ì´ˆê¸°í™”
      initGoogleSheets();
      
      // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ (5ì´ˆ í›„)
      setTimeout(requestNotificationPermission, 5000);
      
      // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ê°ì§€
      document.addEventListener('visibilitychange', handleVisibilityChange);
      
      // í™˜ì˜ ë©”ì‹œì§€
      showInfo('ğŸ‰ Digital Twin Dashboardê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤! Google Sheetsì— ì—°ê²°í•˜ì—¬ ì‹¤ì œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
      
      // í™ˆ ë²„íŠ¼ ê¸°ë³¸ í™œì„±í™”
      document.getElementById('home-btn').classList.add('active');
      
      // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘ (30ì´ˆë§ˆë‹¤)
      setInterval(fetchStatus, 30000);
      fetchStatus();
      
      // ë¬¸ ìƒíƒœ ì²´í¬ (10ì´ˆë§ˆë‹¤)
      setInterval(() => {
        checkDoorStateChanges();
      }, 10000);
      
      // ì´ˆê¸°í™” ì™„ë£Œ ë¡œê·¸
      setTimeout(() => {
        console.log('âœ… Digital Twin Dashboard ì´ˆê¸°í™” ì™„ë£Œ');
        console.log(`ğŸ“Š Google Sheets ì—°ë™: ${isGoogleSheetsConnected ? 'âœ… ì—°ê²°ë¨' : 'âŒ ë¯¸ì—°ê²°'}`);
        console.log(`ğŸ”” ì•Œë¦¼ ê¶Œí•œ: ${Notification.permission}`);
        console.log(`ğŸšª ëª¨ë‹ˆí„°ë§ ì¤‘ì¸ ë¬¸: ${doors.length}ê°œ`);
        console.log('ğŸ“Œ ë”ë¯¸ë°ì´í„° ì œê±°ë¨ - ì‹¤ì œ ì„¼ì„œ ë°ì´í„°ë§Œ ì‚¬ìš©');
        
        if (!isGoogleSheetsConnected) {
          console.log('âš ï¸  Google Sheets API ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”:');
          console.log('   - GOOGLE_SHEETS_CONFIG.apiKey');
          console.log('   - GOOGLE_SHEETS_CONFIG.spreadsheetId');
          console.log('   â€» ì‹¤ì œ ì„¼ì„œ ë°ì´í„° í™•ì¸ì„ ìœ„í•´ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        }
      }, 2000);
    });
  </script>
</body>
</html>